<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <title>Division Fun ‚ûó</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#7bd3ff;
      --bg2:#feb5f9;
      --bg3:#fff09a;
      --card:#ffffffee;
      --text:#1a1a1a;
      --muted:#5a6a7b;
      --good:#18c37f;
      --bad:#ff4d6d;
      --btn1:#6d8cff;
      --btn2:#ff8ccf;
      --btn3:#ffd36e;
      --btn4:#5ee0a0;
      --shadow:0 14px 30px rgba(0,0,0,.18);
      --radius:22px;
      --tap:72px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Fredoka",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;
      color:var(--text);
      background: linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));
      background-size: 200% 200%;
      animation: bgMove 12s ease-in-out infinite;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    @keyframes bgMove{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .wrap{
      min-height:100%;
      display:flex;
      flex-direction:column;
      gap:16px;
      padding:16px;
      align-items:center;
      justify-content:center;
    }
    .topbar{
      width:min(680px,96vw);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:8px 6px;
      gap:8px;
    }
    .title{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:800;
      font-size:clamp(22px,5vw,32px);
      color:#0b2450;
      text-shadow:0 2px 0 rgba(255,255,255,.6);
      letter-spacing:.5px;
    }
    .controls{
      display:flex;
      gap:8px;
    }
    .ctrl-btn{
      border:none;
      border-radius:16px;
      padding:12px 14px;
      min-width:56px;
      font-weight:700;
      font-size:18px;
      background:#ffffffaa;
      backdrop-filter:blur(6px);
      box-shadow:var(--shadow);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      transition:transform .08s ease, background .2s ease;
    }
    .ctrl-btn:active{ transform: scale(.96) }
    .ctrl-btn span{ font-size:22px }
    .card{
      width:min(680px,96vw);
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px 18px 22px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .hint{
      font-size:clamp(16px,3.8vw,20px);
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .problem{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      border-radius:18px;
      background:linear-gradient(135deg,#fff, #f7fcff);
      padding:14px 10px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,.04);
    }
    .expr{
      font-size:clamp(36px,10vw,64px);
      font-weight:800;
      letter-spacing:1px;
      background: linear-gradient(90deg,#2a36a5,#a71eb5);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      text-align:center;
      line-height:1.1;
      user-select:none;
    }
    .streak{
      align-self:center;
      background:#fff7ca;
      color:#7a5a00;
      border-radius:999px;
      padding:8px 14px;
      font-weight:700;
      font-size:clamp(16px,4vw,18px);
      display:flex;
      align-items:center;
      gap:8px;
      box-shadow: 0 6px 14px rgba(255,215,64,.35), inset 0 -2px 0 rgba(0,0,0,.06);
    }
    .opts{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:12px;
      margin-top:4px;
    }
    .btn{
      position:relative;
      border:none;
      border-radius:20px;
      padding:18px;
      min-height:var(--tap);
      font-weight:800;
      font-size:clamp(24px,6vw,34px);
      color:#10223a;
      cursor:pointer;
      box-shadow: var(--shadow);
      transition: transform .08s ease, box-shadow .2s ease, filter .2s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
    }
    .btn:active{ transform: scale(.97) }
    .btn[data-idx="0"]{ background:linear-gradient(135deg,#c6d1ff,#8fb0ff) }
    .btn[data-idx="1"]{ background:linear-gradient(135deg,#ffc1e8,#ff9bd6) }
    .btn[data-idx="2"]{ background:linear-gradient(135deg,#ffe8a6,#ffd36e) }
    .btn[data-idx="3"]{ background:linear-gradient(135deg,#b6ffd8,#5ee0a0) }
    .btn .emoji{
      font-size:clamp(26px,6vw,34px);
      filter: drop-shadow(0 2px 0 rgba(255,255,255,.7));
    }
    .btn.good{
      animation: popGood .6s ease both;
      box-shadow: 0 0 0 6px rgba(24,195,127,.25), var(--shadow);
    }
    @keyframes popGood{
      0%{ transform:scale(1) }
      30%{ transform:scale(1.08) }
      60%{ transform:scale(.98) }
      100%{ transform:scale(1) }
    }
    .btn.bad{
      animation: shake .45s ease both;
      box-shadow: 0 0 0 6px rgba(255,77,109,.25), var(--shadow);
      filter: saturate(1.1);
    }
    @keyframes shake{
      0%,100%{ transform:translateX(0) }
      20%{ transform:translateX(-8px) }
      40%{ transform:translateX(8px) }
      60%{ transform:translateX(-6px) }
      80%{ transform:translateX(6px) }
    }
    .flash{
      position:absolute;
      inset:0;
      border-radius:inherit;
      background:rgba(255,255,255,.35);
      animation: flash .35s ease both;
      pointer-events:none;
    }
    @keyframes flash{
      from{ opacity:1 }
      to{ opacity:0 }
    }
    .overlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:linear-gradient(120deg,rgba(255,255,255,.85),rgba(255,255,255,.6));
      backdrop-filter: blur(6px);
      z-index:20;
    }
    .overlay.show{ display:flex }
    .count{
      text-align:center;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
      justify-content:center;
    }
    .count .num{
      font-size:clamp(64px,18vw,120px);
      font-weight:900;
      line-height:1;
      color:#0b2450;
      text-shadow:0 4px 0 rgba(255,255,255,.7);
      animation: bounce .6s ease;
      user-select:none;
    }
    .count .yay{
      font-size:clamp(28px,6vw,34px);
      color:#045a3a;
      font-weight:800;
      background:#dffbea;
      padding:8px 16px;
      border-radius:999px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,.06);
    }
    @keyframes bounce{
      0%{ transform:scale(.5); opacity:0 }
      60%{ transform:scale(1.1); opacity:1 }
      100%{ transform:scale(1) }
    }
    .confetti{
      position:fixed;
      top:0; left:0;
      pointer-events:none;
      z-index:30;
      font-size:26px;
      animation: fall 900ms ease-out forwards;
      will-change: transform, opacity;
    }
    @keyframes fall{
      0%{ transform: translate(var(--x), var(--y)) scale(1); opacity:1 }
      100%{ transform: translate(calc(var(--x) + var(--dx)), calc(var(--y) + var(--dy))) rotate(var(--rot)); opacity:0 }
    }
    .sr-only{
      position:absolute!important;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);
      white-space:nowrap;border:0;
    }
    @media (prefers-reduced-motion: reduce){
      *{ animation:none!important; transition:none!important }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar" aria-label="Game controls">
      <div class="title" aria-hidden="true">üéà Division Fun! ‚ûó</div>
      <div class="controls">
        <button class="ctrl-btn" id="voiceBtn" aria-pressed="true" aria-label="Toggle voice">
          <span id="voiceIcon">üîä</span>
          <b>Voice</b>
        </button>
        <button class="ctrl-btn" id="skipBtn" aria-label="Skip question">
          <span>‚è≠Ô∏è</span><b>Skip</b>
        </button>
      </div>
    </div>

    <div class="card" role="group" aria-label="Math question">
      <div class="hint">üëâ Tap the answer!</div>
      <div class="problem">
        <div class="expr" id="expr" aria-live="polite">8 √∑ 2 = ?</div>
      </div>
      <div class="streak" id="streak" aria-live="polite">üåà Streak: 0</div>
      <div class="opts" id="opts" role="listbox" aria-label="Choices"></div>
    </div>
  </div>

  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-live="polite">
    <div class="count">
      <div class="yay" id="yay">üåü Great job!</div>
      <div class="num" id="num">3Ô∏è‚É£</div>
    </div>
  </div>

  <div class="sr-only" aria-live="polite" id="live"></div>

  <script>
    const exprEl = document.getElementById('expr');
    const optsEl = document.getElementById('opts');
    const overlay = document.getElementById('overlay');
    const numEl = document.getElementById('num');
    const yayEl = document.getElementById('yay');
    const streakEl = document.getElementById('streak');
    const voiceBtn = document.getElementById('voiceBtn');
    const voiceIcon = document.getElementById('voiceIcon');
    const skipBtn = document.getElementById('skipBtn');
    const live = document.getElementById('live');

    let a=0,b=0,answer=0,locked=false,streak=0,voiceOn=true;
    let countdownTimer = null;

    const emojiNumbers = ["3Ô∏è‚É£","2Ô∏è‚É£","1Ô∏è‚É£","üöÄ"];
    const btnEmojis = ["üê£","üß©","üç¨","‚≠ê"];
    const confettiPool = ["üéâ","‚ú®","üéà","üåü","üí´","‚≠ê","üéä"];

    function randint(n,m){ return Math.floor(Math.random()*(m-n+1))+n; }

    function speak(t){
      try{
        if(!voiceOn || !('speechSynthesis' in window)) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(String(t));
        u.lang='en-US';
        u.rate=1.0;
        u.pitch=1.1;
        window.speechSynthesis.speak(u);
      }catch(_){}
    }

    function vibrate(ms){
      if('vibrate' in navigator){ try{ navigator.vibrate(ms); }catch(_){} }
    }

    function sampleWrongAnswers(ans){
      const set = new Set([ans]);
      const options = [ans];
      const candidates = [];
      for(let d=1; d<=5; d++) { candidates.push(ans+d, ans-d); }
      while(options.length < 4){
        let v;
        if(candidates.length && Math.random()<0.7){
          v = candidates.splice(randint(0,candidates.length-1),1)[0];
        }else{
          v = randint(Math.max(0,ans-7), ans+7);
        }
        if(Number.isFinite(v) && v>=0 && !set.has(v)){
          set.add(v); options.push(v);
        }
      }
      return shuffle(options);
    }

    function shuffle(arr){ return arr.sort(()=>Math.random()-.5); }

    function newQuestion(){
      locked = false;
      // ensure integer division
      const m = randint(2,9), n = randint(2,9);
      if(Math.random() < 0.5){ a = m*n; b = m; } else { a = m*n; b = n; }
      answer = a / b;

      exprEl.textContent = `${a} √∑ ${b} = ?`;
      exprEl.style.animation = 'bounce .5s ease';
      setTimeout(()=> exprEl.style.animation = '', 520);

      const options = sampleWrongAnswers(answer);
      renderOptions(options);
      speak(`${a} divided by ${b}. What is the answer?`);
    }

    function renderOptions(options){
      optsEl.innerHTML = '';
      options.forEach((v, i)=>{
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.type = 'button';
        btn.setAttribute('role','option');
        btn.setAttribute('aria-label', `Answer ${v}`);
        btn.dataset.idx = i;
        btn.innerHTML = `<span class="emoji">${btnEmojis[i%btnEmojis.length]}</span> <span class="val">${v}</span>`;
        btn.addEventListener('click', ()=> pick(btn, v));
        optsEl.appendChild(btn);
      });
    }

    function pick(btn, v){
      if(locked) return;
      locked = true;

      const flash = document.createElement('div');
      flash.className = 'flash';
      btn.appendChild(flash);

      if(v === answer){
        btn.classList.add('good');
        streak++;
        updateStreak();
        celebration(btn);
        speak('Correct! Yay!');
        vibrate(80);
        setTimeout(()=> showCountdown(nextQuestion), 650);
      }else{
        btn.classList.add('bad');
        streak = 0;
        updateStreak();
        popEmoji(btn, '‚ùå');
        speak('Try again!');
        vibrate([30,40,30]);
        setTimeout(()=>{ btn.classList.remove('bad'); locked=false; }, 450);
      }
    }

    function updateStreak(){
      streakEl.textContent = `üåà Streak: ${streak}`;
      live.textContent = `Streak ${streak}`;
    }

    function popEmoji(el, ch){
      const rect = el.getBoundingClientRect();
      const span = document.createElement('span');
      span.textContent = ch;
      span.style.position='fixed';
      span.style.left = (rect.left + rect.width/2 - 12) + 'px';
      span.style.top = (rect.top - 10) + 'px';
      span.style.fontSize='28px';
      span.style.zIndex='15';
      span.style.transition='transform .6s ease, opacity .6s ease';
      span.style.transform='translateY(0)';
      span.style.opacity='1';
      document.body.appendChild(span);
      requestAnimationFrame(()=>{
        span.style.transform='translateY(-22px) scale(1.2)';
        span.style.opacity='0';
      });
      setTimeout(()=> span.remove(), 620);
    }

    function celebration(btn){
      const rect = btn.getBoundingClientRect();
      const x = rect.left + rect.width/2;
      const y = rect.top + rect.height/2;
      for(let i=0;i<20;i++){
        const s = document.createElement('span');
        s.className='confetti';
        s.textContent = confettiPool[randint(0,confettiPool.length-1)];
        s.style.left = '0px'; s.style.top='0px';
        s.style.setProperty('--x', x+'px');
        s.style.setProperty('--y', y+'px');
        const dx = (Math.random()*2-1)*160;
        const dy = (Math.random()*-1)*220 - 80;
        const rot = (Math.random()*2-1)*180+'deg';
        s.style.setProperty('--dx', dx+'px');
        s.style.setProperty('--dy', dy+'px');
        s.style.setProperty('--rot', rot);
        document.body.appendChild(s);
        setTimeout(()=> s.remove(), 950);
      }
      popEmoji(btn, '‚úÖ');
    }

    function showCountdown(done){
      overlay.classList.add('show');
      yayEl.textContent = ['üåü Great job!','üéâ Woohoo!','üòÑ You got it!','üëè Nice!'][randint(0,3)];
      let idx = 0;
      numEl.textContent = emojiNumbers[idx];
      numEl.style.animation = 'bounce .6s ease';
      countdownTimer && clearInterval(countdownTimer);
      countdownTimer = setInterval(()=>{
        idx++;
        if(idx >= emojiNumbers.length){
          clearInterval(countdownTimer);
          overlay.classList.remove('show');
          done();
          return;
        }
        numEl.textContent = emojiNumbers[idx];
        numEl.style.animation = 'none';
        void numEl.offsetWidth; // reflow to restart anim
        numEl.style.animation = 'bounce .6s ease';
      }, 650);
    }

    function nextQuestion(){
      newQuestion();
    }

    voiceBtn.addEventListener('click', ()=>{
      voiceOn = !voiceOn;
      voiceBtn.setAttribute('aria-pressed', String(voiceOn));
      voiceIcon.textContent = voiceOn ? 'üîä' : 'üîá';
      vibrate(20);
    });

    skipBtn.addEventListener('click', ()=>{
      vibrate(30);
      speak('Skipping to a new question');
      newQuestion();
    });

    // Initialize
    newQuestion();
  </script>
</body>
</html>